---
const currentYear = new Date().getFullYear();
const years = Array.from({ length: 10 }, (_, i) => currentYear + i);
---

<label>
  <p class="mb-1">Year</p>
  <input
    type="text"
    data-year-input
    class="w-20 p-1 text-lg text-slate-900"
    value={currentYear}
  />
  <div
    data-year-dropdown
    class="absolute flex hidden w-20 flex-col bg-slate-50"
  >
    {
      years.map((year) => (
        <button
          type="button"
          class="p-1 text-lg text-slate-900 hover:bg-slate-200"
        >
          {year}
        </button>
      ))
    }
  </div>
</label>
<script>
  const input = document.querySelector('[data-year-input]') as HTMLInputElement;
  const buttons = document.querySelectorAll('button');
  const dropdown = document.querySelector(
    '[data-year-dropdown]',
  ) as HTMLDivElement;
  const MAX_YEAR = 4000;

  buttons.forEach((button) => {
    button.addEventListener('click', () => {
      input.value = button.innerText;
    });
  });

  input.addEventListener('input', () => {
    updateDropdown();
  });

  input.addEventListener('focus', () => {
    updateDropdown();
    dropdown.classList.remove('hidden');
  });

  window.addEventListener('click', (event) => {
    if (event.target !== input) {
      dropdown.classList.add('hidden');
    }
  });

  function updateDropdown() {
    const year = Number(input.value);

    if (isNaN(year)) return;

    const suggestedYear = suggestYear(year);
    buttons.forEach((button, index) => {
      button.innerText = String(suggestedYear + index + 1);
    });
  }

  function suggestYear(year: number) {
    if (year > MAX_YEAR) {
      return MAX_YEAR - buttons.length;
    }

    year = Math.max(year, 1);

    const firstDigit = Number(String(year)[0]);
    const minYear = [1, 2].includes(firstDigit) ? 1000 : 100;

    while (year < minYear) {
      year *= 10;
    }

    return year;
  }
</script>
